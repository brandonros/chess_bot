apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: linkerd-crds
  namespace: kube-system
spec:
  repo: https://helm.linkerd.io/stable
  chart: linkerd-crds
  version: 1.8.0
  targetNamespace: linkerd
  createNamespace: true
  valuesContent: |-
    # TODO: CRD collision as per https://github.com/linkerd/linkerd2/issues/12232
    # kubectl delete crd httproutes.policy.linkerd.io
    enableHttpRoutes: true
    enableTcpRoutes: false
    enableTlsRoutes: false
---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: linkerd-control-plane
  namespace: kube-system
spec:
  repo: https://helm.linkerd.io/stable
  chart: linkerd-control-plane
  version: 1.16.11
  targetNamespace: linkerd
  valuesContent: |-
    prometheusUrl: "http://kube-prometheus-stack-prometheus.monitoring.svc.cluster.local:9090"
    podMonitor:
      enabled: true
      controller:
        enabled: true
        namespaceSelector: |
          matchNames:
            - {{ .Release.Namespace }}
            - chess-bot
    identityTrustAnchorsPEM: |
${CA_CERT_PEM}
    identity:
      issuer:
        scheme: linkerd.io/tls
        tls:
          crtPEM: |
${ISSUER_CERT_PEM}
          keyPEM: |
${ISSUER_KEY_PEM}
